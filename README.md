# LAA Digital Hackathon - July 2024

## Project `genaitests`

The source code for the Team 4 Hackathon project is split into two top-level
directories to allow concurrent development by the team.

If this were not part of a three-day hackathon, it's likely we'd avoid mixing
a Java Spring Boot web application and a Python script in this way.

## Directory `boot-api/`

A Spring Boot web application that serves two purposes:

* `POST /scenario` accepts a `requirements` string array and responds with a
  `scenarios` string array, generated by the OpenAI API.
* `POST /webhook` accepts a web hook notification from Jira Cloud and runs
  the Python script to handle the event.

### Configuring the web app

You will need an OpenAI API key to put into `application.properties` and a
free ngrok account auth token to be able to expose the web hook endpoint.

### Exposing the Jira Cloud web hook handler

Jira Cloud can only access Internet-exposed web hook endpoints, so we use the
ngrok service to expose our local endpoint as a publicly-accessible HTTPS
endpoint.

```bash
brew install ngrok/ngrok/ngrok
ngrok config add-authtoken ${NGROK_AUTH_TOKEN}
ngrok http 8080
```

Additionally, make a note of the ngrok endpoint URL that is assigned by the
`ngrok` command-line, and set this as the URL of a new Web Hook in Jira's
admin settings (which should include at least the **Issue related events** /
**Comment** / **created** event).

To have access to admin settings is one good reason to create a new Jira
Cloud workspace. You can find Jira's Web Hook configuration towards the
bottom of the **System** Jira admin settings, in the **Advanced** section.

## Directory `py-jira/`

A Python script using the `atlassian-python-api` and `requests` packages to
talk to Jira and the `/scenario` Spring Boot API to get the Jira issue
description text as the `requirements`, convert these `requirements` into
test `scenarios`, and then append these generated test `scenarios` as an
issue comment on the Jira issue.

### Installing the Python requirements

Use a virtual environment to isolate the installed required dependencies.
Note we use a shell script (`runmain`) to invoke the Python file (`main.py`)
so that we don't have to start the Spring Boot web app from a shell which
has already activated the virtual environment.

```bash
cd py-jira
python3 -m venv .venv
. .venv/bin/activate
pip install requests atlassian-python-api
chmod +x runmain
```

### Configuring the Python script

At the start of `main.py`, edit the values of the variables `JIRA_URL`,
`USER` and `TOKEN` for your Jira Cloud bot account (note that `TOKEN` is a
revocable Jira API token, generated for the Jira Cloud user or project,
**not** the bot account's Jira Cloud password).

Create a new free Jira Cloud workspace, and a dedicated email for the bot
account (e.g. a new GMail account) to keep this entirely separate from work
Jira Cloud instances and accounts.
